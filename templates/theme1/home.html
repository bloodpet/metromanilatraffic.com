{% extends base_template %}

{% block title %}
Home
{% endblock %}

{% block page_title %}
Metro Manila Traffic
{% endblock %}

{% block content %}
	{% for road in roads %}
	<div class="roads ui-widget{% if road.get_latest_status %} active-road{% endif %}">
		<h3>
			<a href="#">
			{{ road.name }}
			{% if road.get_latest_status %}
			as of {{ road.get_latest_status.status_at|time }}
			{% endif %}
			</a>
		</h3>
		<div class="road-block">
			{% if road.northbound %}
			<div class="road" count="{{ road.northbound.count }}">
				<h4>Northbound</h4>
				<div class="traffic">
					{% for section in road.northbound %}
					{% include section_template %}
					{% endfor %}
				</div>
			</div>
			{% endif %}
			{% if road.southbound %}
			<div class="road" count="{{ road.northbound.count }}">
				<h4>Southbound</h4>
				<div class="traffic">
					{% for section in road.southbound %}
					{% include section_template %}
					{% endfor %}
				</div>
			</div>
			{% endif %}
			{% if road.eastbound %}
			<div class="road" count="{{ road.northbound.count }}">
				<h4>Eastbound</h4>
				<div class="traffic">
					{% for section in road.eastbound %}
					{% include section_template %}
					{% endfor %}
				</div>
			</div>
			{% endif %}
			{% if road.westbound %}
			<div class="road" count="{{ road.northbound.count }}">
				<h4>Westbound</h4>
				<div class="traffic">
					{% for section in road.westbound %}
					{% include section_template %}
					{% endfor %}
				</div>
			</div>
			{% endif %}
		</div>
	</div>
	{% endfor %}
{% endblock %}

{% block extrascripts %}
	<script type="text/javascript">
		{% if not request.GET.full %}
		if (Modernizr.touch){
			// bind to touchstart, touchmove, etc and watch `event.streamId`
			window.location = '{% url mobile-home %}';
		} else {
			// bind to normal click, mousemove, etc
		}
		{% endif %}
		$(document).ready(function () {
			$('.road').each(function () {
				// Resize element that contains all the sections
				var el = $(this);
				var width = parseInt(el.attr('count')) * (148 + 4);
				el.find('.traffic').css({width: width + 'px'});
			});
			$('#content-container').sortable({
				distance: 32
			});
			$('.roads').accordion({
				active: 1,
				autoHeight: false,
				collapsible: true,
				navigation: true
			});
			$('.traffic').draggable({
				grid: [76, 32],
				axis: 'x'
			});
			/* Activate roads with updates
			$('.active-road').accordion({
				active: 0
			});
			*/
		});
	</script>
{% endblock %}

